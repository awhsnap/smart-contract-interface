<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Refund Contract Interface</title><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css><script src=https://cdn.jsdelivr.net/npm/web3@1.3.6/dist/web3.min.js></script><script src=https://cdn.jsdelivr.net/npm/timeago.js@4.0.2/dist/timeago.min.js></script><style>#recentDeposits,#recentWithdrawals{max-height:200px;overflow-y:auto;border:0 solid #ccc;padding:10px;margin-bottom:20px}#ownerdiv{display:none}</style></head><body><body class="bg-gray-100 font-sans p-4"><h1 class="text-3xl font-bold mb-4">Refund Contract Interface</h1><div class="flex mb-4"><div class="flex-1 mr-4 bg-white p-4 rounded shadow"><h2 class="text-xl font-bold mb-2">Wallet Info</h2><p id=walletAddress>Connected Wallet: Loading...</p></div><div class="flex-1 mr-4 bg-white p-4 rounded shadow"><h2 class="text-xl font-bold mb-2">Deposit</h2><label for=depositAmount class="block mb-2">Deposit Amount:</label><input type=number id=depositAmount class="border p-2 mb-2"><button onclick=deposit() class="bg-blue-500 text-white px-4 py-2 rounded">Deposit</button></div><div class="flex-1 bg-white p-4 rounded shadow"><h2 class="text-xl font-bold mb-2">Withdraw</h2><label for=withdrawAmount class="block mb-2">Withdraw Amount:</label><input type=number id=withdrawAmount class="border p-2 mb-2"><button onclick=withdraw() class="bg-red-500 text-white px-4 py-2 rounded">Withdraw</button></div><div id=ownerdiv class="flex-1 ml-4 bg-white p-4 rounded shadow"><h2 class="text-xl font-bold mb-2">Owner Actions</h2><button id=withdrawContractBalanceBtn onclick=withdrawContractBalance() class="bg-yellow-500 text-white px-4 py-2 rounded" style=display:none>Withdraw Contract Balance (Owner only)</button></div></div><div class="bg-white p-4 mb-4 rounded shadow"><h2 class="text-xl font-bold mb-2">Recent Transactions</h2><div class=flex><div class="flex-1 mr-4"><h3 class="text-lg font-bold mb-2">Deposits</h3><ul id=recentDeposits class="list-disc pl-4 scrollable-container"></ul></div><div class=flex-1><h3 class="text-lg font-bold mb-2">Withdrawals</h3><ul id=recentWithdrawals class="list-disc pl-4 scrollable-container"></ul></div></div></div><div class="bg-white p-4 mb-4 rounded shadow"><h2 class="text-xl font-bold mb-2">Contract Balance</h2><p id=contractBalance class=text-gray-800>Contract Balance: Loading...</p></div><div class="bg-white p-4 mb-4 rounded shadow"><h2 class="text-xl font-bold mb-2">Events</h2><ul id=eventList class="list-disc pl-4"></ul></div><div class="bg-white p-4 mb-4 rounded shadow"><h2 class="text-xl font-bold mb-2">List of Transactions</h2><ul id=transactionList class="list-disc pl-4"></ul></div><script>void 0!==window.ethereum?(window.web3=new Web3(window.ethereum),window.ethereum.enable()):void 0!==window.web3?window.web3=new Web3(window.web3.currentProvider):alert("Please install MetaMask to use this interface.");const web3=new Web3(window.ethereum),contractAddress="0x998a53eB0E6c4cE3a0bEEb1e5DDe90F03327FA9A",contractABI=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Deposit",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"recipient",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Withdrawal",type:"event"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"balances",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"deposit",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"}],name:"withdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"withdrawContractBalance",outputs:[],stateMutability:"nonpayable",type:"function"}],refundContract=new web3.eth.Contract(contractABI,contractAddress);async function isOwner(){try{var e=await web3.eth.requestAccounts();return(await refundContract.methods.owner().call()).toLowerCase()===e[0].toLowerCase()}catch(e){return console.error("Error checking ownership:",e),!1}}async function updateOwnerActionsVisibility(){try{var e=document.getElementById("withdrawContractBalanceBtn"),t=await isOwner();e.style.display=t?"block":"none",ownerdiv.style.display=t?"block":"none",ownerdiv.style.display=t?"display":"none",console.log("Current account is owner: "+t)}catch(e){console.error("Error updating owner actions visibility:",e)}}async function displayWalletAddress(){var e=await web3.eth.requestAccounts(),t=document.getElementById("walletAddress");0<e.length?t.textContent="Connected Wallet: "+e[0]:t.textContent="Connected Wallet: Not available"}async function deposit(){var e=document.getElementById("depositAmount").value;try{var t=await web3.eth.requestAccounts();await refundContract.methods.deposit().send({from:t[0],value:web3.utils.toWei(e,"ether")}),alert("Deposit successful!")}catch(e){alert("Error: "+e.message)}}async function withdraw(){var e=document.getElementById("withdrawAmount").value;try{var t=await web3.eth.requestAccounts();await refundContract.methods.withdraw(web3.utils.toWei(e,"ether")).send({from:t[0]}),displayRecentTransactions(),alert("Withdrawal successful!")}catch(e){alert("Error: "+e.message)}}async function displayContractBalance(){var e=await web3.eth.getBalance(contractAddress),e=web3.utils.fromWei(e,"ether");document.getElementById("contractBalance").textContent=`Contract Balance: ${e} ETH`}async function getRecentTransactions(e){var t=await refundContract.getPastEvents("Deposit",{filter:{sender:e},fromBlock:0,toBlock:"latest"}),e=await refundContract.getPastEvents("Withdrawal",{filter:{recipient:e},fromBlock:0,toBlock:"latest"});return console.log("Deposit Events:",t),console.log("Withdraw Events:",e),[...t,...e]}async function displayRecentTransactions(){var e=(await web3.eth.requestAccounts())[0],t=document.getElementById("recentDeposits"),n=document.getElementById("recentWithdrawals"),e=(t.innerHTML="",n.innerHTML="",await getRecentTransactions(e));e.sort((e,t)=>t.blockNumber-e.blockNumber);for(const i of e){var a=document.createElement("li"),r=i.returnValues.amount?web3.utils.fromWei(i.returnValues.amount,"ether"):"N/A",o=await web3.eth.getBlock(i.blockNumber),o=o?convertUnixTimestamp(o.timestamp):"N/A";a.textContent=i.event+`: ${r} ETH - Timestamp: `+o,"Deposit"===i.event?t.appendChild(a):"Withdrawal"===i.event&&n.appendChild(a)}}function convertUnixTimestamp(e){e=new Date(1e3*e);return new Intl.DateTimeFormat("default",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}).format(e)}function convertUnixTimestamp(e){e=new Date(1e3*e);return new Intl.DateTimeFormat("default",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}).format(e)}async function displayEvents(){var e=await contractInstance.getPastEvents("allEvents",{fromBlock:0,toBlock:"latest"});const n=document.getElementById("eventList");e.forEach(e=>{var t=document.createElement("li");t.textContent=`Event: ${e.event}, Block Number: ${e.blockNumber}, Transaction Hash: `+e.transactionHash,n.appendChild(t)})}async function withdrawContractBalance(){try{var e=await web3.eth.requestAccounts();await refundContract.methods.withdrawContractBalance().send({from:e[0]}),alert("Contract balance withdrawn by owner!")}catch(e){alert("Error: "+e.message)}}async function displayTransactions(){var t=await web3.eth.getBlockNumber(),n=[];for(let e=0;e<t;e++){var a=await web3.eth.getBlock(e,!0);a&&0<a.transactions.length&&n.push(...a.transactions)}const r=document.getElementById("transactionList");n.forEach(e=>{var t=document.createElement("li");t.textContent=`Transaction Hash: ${e.hash}, Block Number: `+e.blockNumber,r.appendChild(t)})}window.ethereum.request({method:"eth_requestAccounts"}).then(()=>{console.log("Connected to MetaMask"),updateOwnerActionsVisibility(),displayWalletAddress(),displayEvents(),displayContractBalance(),displayRecentTransactions(),displayTransactions()}).catch(e=>{console.error("Error connecting to MetaMask:",e)})</script></body></body></html>